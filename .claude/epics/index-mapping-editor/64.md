---
name: 实现前端状态管理和 API 集成
status: open
created: 2025-09-26T04:12:20Z
updated: 2025-09-26T04:21:27Z
github: https://github.com/zhailiang23/deepSearch/issues/64
depends_on: [61, 63]
parallel: false
conflicts_with: []
---

# Task: 实现前端状态管理和 API 集成

## Description

扩展现有的 Pinia store，增加 mapping 相关状态管理，创建 API 调用模块，实现前后端数据交互，完成 MappingConfigTab 组件的数据绑定和业务逻辑。

## Acceptance Criteria

- [ ] 扩展现有 searchSpace store 增加 mapping 状态
- [ ] 创建 mappingApi.ts API 调用模块
- [ ] 实现 fetchMapping 和 updateMapping actions
- [ ] 在 MappingConfigTab 中集成状态管理
- [ ] 实现数据加载和保存功能
- [ ] 添加 loading 状态和错误处理
- [ ] 实现数据缓存和更新机制

## Technical Details

**文件涉及：**
1. `frontend/src/stores/searchSpace.ts` - 状态管理扩展
2. `frontend/src/api/mappingApi.ts` - API 调用模块
3. `frontend/src/components/searchSpace/MappingConfigTab.vue` - 组件数据绑定

**状态管理扩展：**
```typescript
// 新增状态
interface MappingState {
  currentMapping: string | null
  loading: boolean
  error: string | null
  lastUpdated: Date | null
}

// 新增 actions
async function fetchMapping(spaceId: number): Promise<string>
async function updateMapping(spaceId: number, mapping: string): Promise<void>
```

**API 模块结构：**
```typescript
// mappingApi.ts
export const mappingApi = {
  getMapping: (spaceId: number) => Promise<string>,
  updateMapping: (spaceId: number, mapping: string) => Promise<void>
}
```

**组件集成：**
- 使用 Pinia store 管理数据状态
- 实现组件加载时自动获取 mapping
- 绑定编辑器内容与 store 状态
- 实现保存操作调用 API 更新

**错误处理：**
- 网络错误处理
- 服务器错误响应处理
- JSON 格式错误处理
- 用户友好的错误提示

## Dependencies

- [ ] MappingConfigTab 组件已创建（任务 003）
- [ ] 后端 API 服务已实现（任务 005）
- [ ] 现有 searchSpace store 功能正常

## Effort Estimate

- Size: M
- Hours: 8-10 小时
- Parallel: false（需要前端组件和后端 API 都完成）

## Definition of Done

- [ ] Pinia store 扩展完成并测试通过
- [ ] API 调用模块创建完成
- [ ] 前后端数据交互正常
- [ ] MappingConfigTab 组件数据绑定正确
- [ ] 加载和保存功能正常工作
- [ ] 错误处理机制完善
- [ ] Loading 状态显示正确
- [ ] 数据缓存机制有效
- [ ] TypeScript 类型定义完整
- [ ] 单元测试覆盖 store 和 API 模块
