# Task 001: Backend Security Infrastructure

## Metadata
```yaml
task_id: 001
name: Backend Security Infrastructure
description: 配置 Spring Security + JWT 认证框架，实现 JwtTokenProvider 工具类
epic: loginAndLogout
created_at: 2025-09-21T11:14:58Z
updated_at: 2025-09-21T12:06:31Z
estimated_hours: 4
priority: high
parallel: false
depends_on: []
tags: [backend, security, jwt, foundation]
github: https://github.com/zhailiang23/deepSearch/issues/11
status: closed
assignee: zhailiang23
```

## Background
实现用户登录登出功能的基础设施。需要配置Spring Security框架，集成JWT认证机制，为后续的认证和授权功能奠定基础。

## Objectives
- 配置Spring Security基础框架
- 集成JWT认证机制
- 实现JwtTokenProvider核心工具类
- 配置安全过滤器链
- 设置跨域和安全头配置

## Technical Requirements

### Spring Security配置
- 配置SecurityConfig类
- 设置密码编码器(BCryptPasswordEncoder)
- 配置认证管理器
- 设置安全过滤器链
- 配置CORS和CSRF设置

### JWT集成
- 引入jwt相关依赖
- 配置JWT认证过滤器
- 实现JWT认证入口点
- 设置无状态会话管理

### 核心工具类
- JwtTokenProvider: JWT令牌提供者
  - 生成访问令牌
  - 验证令牌有效性
  - 解析令牌信息
  - 获取用户信息

## Implementation Details

### 依赖添加
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.11.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.11.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.11.5</version>
</dependency>
```

### 核心类结构
1. `SecurityConfig` - Spring Security主配置
2. `JwtAuthenticationFilter` - JWT认证过滤器
3. `JwtAuthenticationEntryPoint` - 认证入口点
4. `JwtTokenProvider` - JWT令牌工具类
5. `CustomUserDetailsService` - 用户详情服务

### 配置要点
- 禁用CSRF（使用JWT时通常禁用）
- 配置CORS允许前端访问
- 设置无状态会话管理
- 配置JWT过滤器顺序
- 设置公开端点（如登录、注册）

## Acceptance Criteria
- [ ] Spring Security框架配置完成
- [ ] JWT认证机制集成成功
- [ ] JwtTokenProvider工具类实现完整
- [ ] 安全过滤器链正确配置
- [ ] CORS配置允许前端访问
- [ ] 单元测试覆盖核心功能
- [ ] 集成测试验证安全配置

## Testing Strategy
- 单元测试JwtTokenProvider各个方法
- 集成测试Spring Security配置
- 测试JWT过滤器认证流程
- 验证CORS配置有效性
- 测试无效令牌的处理

## Files to Create/Modify
- `src/main/java/com/deepsearch/security/SecurityConfig.java`
- `src/main/java/com/deepsearch/security/JwtAuthenticationFilter.java`
- `src/main/java/com/deepsearch/security/JwtAuthenticationEntryPoint.java`
- `src/main/java/com/deepsearch/security/JwtTokenProvider.java`
- `src/main/java/com/deepsearch/security/CustomUserDetailsService.java`
- `src/main/resources/application.yml` (添加JWT配置)
- `pom.xml` (添加安全依赖)

## Notes
- JWT密钥将在Task 002中详细配置
- 用户实体和服务将复用existing User相关代码
- 需要确保与现有数据库模式兼容
- 考虑后续的角色权限扩展需求

## Definition of Done
- 所有代码通过code review
- 单元测试覆盖率 >= 80%
- 集成测试通过
- 安全配置经过验证
- 文档更新完成