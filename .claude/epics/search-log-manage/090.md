---
title: 日志管理界面实现
epic: search-log-manage
created: 2025-09-27T02:07:15Z
updated: 2025-09-27T17:30:00Z
completed: 2025-09-27T17:30:00Z
estimate: 2-3天
parallel: true
depends_on: [005]
status: completed
---

# 007 - 日志管理界面实现

## 任务描述

创建完整的搜索日志管理界面，包括SearchLogManagePage主页面和相关子组件。实现日志列表展示、详情查看、多维度筛选、点击行为分析等功能。采用Vue 3 + TypeScript + TailwindCSS技术栈，遵循现有的淡绿色主题设计，确保响应式布局和良好的用户体验。

## 验收标准

### 功能要求
- [ ] 实现SearchLogManagePage主管理页面
- [ ] 创建日志列表组件（分页、排序、筛选）
- [ ] 实现日志详情展示组件
- [ ] 创建高级筛选组件
- [ ] 实现点击行为分析展示
- [ ] 添加搜索统计数据看板
- [ ] 支持数据导出功能

### 界面设计要求
- [ ] 遵循淡绿色主题设计
- [ ] 响应式布局，支持移动端访问
- [ ] 清晰的数据表格展示
- [ ] 直观的筛选和搜索界面
- [ ] 友好的加载和错误状态提示

### 代码质量要求
- [ ] 使用Vue 3 Composition API
- [ ] 完整的TypeScript类型支持
- [ ] 遵循现有组件命名规范
- [ ] 实现适当的错误边界处理
- [ ] 包含组件单元测试

## 技术实施细节

### 1. 主管理页面

**文件路径：** `frontend/src/views/admin/SearchLogManagePage.vue`

**主页面实现：**
```vue
<template>
  <div class="search-log-manage-page">
    <!-- 页面头部 -->
    <PageHeader
      title="搜索日志管理"
      description="查看和分析用户搜索行为数据"
    >
      <template #actions>
        <Button
          @click="refreshData"
          :loading="isRefreshing"
          variant="outline"
          size="sm"
        >
          <RefreshIcon class="w-4 h-4 mr-2" />
          刷新
        </Button>
        <Button
          @click="exportData"
          :loading="isExporting"
          variant="default"
          size="sm"
        >
          <DownloadIcon class="w-4 h-4 mr-2" />
          导出
        </Button>
      </template>
    </PageHeader>

    <!-- 统计数据看板 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <StatCard
        title="总搜索次数"
        :value="statistics.totalSearches"
        :loading="statisticsLoading"
        icon="SearchIcon"
        color="green"
      />
      <StatCard
        title="成功率"
        :value="`${statistics.successRate}%`"
        :loading="statisticsLoading"
        icon="CheckCircleIcon"
        color="green"
      />
      <StatCard
        title="平均响应时间"
        :value="`${statistics.avgResponseTime}ms`"
        :loading="statisticsLoading"
        icon="ClockIcon"
        color="blue"
      />
      <StatCard
        title="总点击次数"
        :value="statistics.totalClicks"
        :loading="statisticsLoading"
        icon="CursorClickIcon"
        color="purple"
      />
    </div>

    <!-- 筛选器 -->
    <Card class="mb-6">
      <SearchLogFilter
        v-model="filterParams"
        @filter="handleFilter"
        @reset="handleResetFilter"
      />
    </Card>

    <!-- 数据表格 -->
    <Card>
      <SearchLogTable
        :data="tableData"
        :loading="tableLoading"
        :pagination="pagination"
        @page-change="handlePageChange"
        @sort-change="handleSortChange"
        @view-detail="handleViewDetail"
      />
    </Card>

    <!-- 详情弹窗 -->
    <SearchLogDetailModal
      v-model:visible="detailModalVisible"
      :log-id="selectedLogId"
      @close="handleCloseDetail"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted, watch } from 'vue'
import { useRouter } from 'vue-router'
import { message } from '@/utils/message'
import { searchLogApi } from '@/api/searchLog'
import { exportToExcel } from '@/utils/export'
import type {
  SearchLog,
  SearchLogQuery,
  SearchLogStatistics
} from '@/types/searchLog'

// 组件导入
import PageHeader from '@/components/common/PageHeader.vue'
import StatCard from '@/components/common/StatCard.vue'
import Card from '@/components/ui/Card.vue'
import Button from '@/components/ui/Button.vue'
import SearchLogFilter from '@/components/search-log/SearchLogFilter.vue'
import SearchLogTable from '@/components/search-log/SearchLogTable.vue'
import SearchLogDetailModal from '@/components/search-log/SearchLogDetailModal.vue'

const router = useRouter()

// 响应式数据
const isRefreshing = ref(false)
const isExporting = ref(false)
const statisticsLoading = ref(false)
const tableLoading = ref(false)
const detailModalVisible = ref(false)
const selectedLogId = ref<number | null>(null)

// 统计数据
const statistics = reactive<SearchLogStatistics>({
  totalSearches: 0,
  successRate: 0,
  avgResponseTime: 0,
  totalClicks: 0,
  topKeywords: [],
  searchTrends: []
})

// 筛选参数
const filterParams = reactive<SearchLogQuery>({
  page: 0,
  size: 20,
  sort: 'createdAt',
  direction: 'desc'
})

// 表格数据
const tableData = ref<SearchLog[]>([])
const pagination = reactive({
  page: 0,
  size: 20,
  total: 0,
  totalPages: 0
})

/**
 * 初始化数据
 */
onMounted(async () => {
  await Promise.all([
    loadStatistics(),
    loadTableData()
  ])
})

/**
 * 监听筛选参数变化
 */
watch(
  () => ({ ...filterParams }),
  () => {
    loadTableData()
  },
  { deep: true }
)

/**
 * 加载统计数据
 */
const loadStatistics = async () => {
  try {
    statisticsLoading.value = true

    const endTime = new Date()
    const startTime = new Date()
    startTime.setDate(startTime.getDate() - 30) // 最近30天

    const response = await searchLogApi.getSearchStatistics(
      startTime.toISOString(),
      endTime.toISOString()
    )

    if (response.success) {
      Object.assign(statistics, response.data)
    }
  } catch (error) {
    console.error('加载统计数据失败:', error)
    message.error('统计数据加载失败')
  } finally {
    statisticsLoading.value = false
  }
}

/**
 * 加载表格数据
 */
const loadTableData = async () => {
  try {
    tableLoading.value = true

    const response = await searchLogApi.getSearchLogs(filterParams)

    if (response.success) {
      tableData.value = response.data.content
      Object.assign(pagination, {
        page: response.data.page,
        size: response.data.size,
        total: response.data.totalElements,
        totalPages: response.data.totalPages
      })
    }
  } catch (error) {
    console.error('加载表格数据失败:', error)
    message.error('数据加载失败')
  } finally {
    tableLoading.value = false
  }
}

/**
 * 处理筛选
 */
const handleFilter = (filters: Partial<SearchLogQuery>) => {
  Object.assign(filterParams, filters, { page: 0 })
}

/**
 * 重置筛选
 */
const handleResetFilter = () => {
  Object.assign(filterParams, {
    userId: undefined,
    searchSpaceId: undefined,
    query: undefined,
    status: undefined,
    startTime: undefined,
    endTime: undefined,
    minResponseTime: undefined,
    maxResponseTime: undefined,
    page: 0,
    size: 20,
    sort: 'createdAt',
    direction: 'desc'
  })
}

/**
 * 处理分页变化
 */
const handlePageChange = (page: number, size: number) => {
  filterParams.page = page
  filterParams.size = size
}

/**
 * 处理排序变化
 */
const handleSortChange = (sort: string, direction: 'asc' | 'desc') => {
  filterParams.sort = sort
  filterParams.direction = direction
  filterParams.page = 0
}

/**
 * 查看详情
 */
const handleViewDetail = (logId: number) => {
  selectedLogId.value = logId
  detailModalVisible.value = true
}

/**
 * 关闭详情
 */
const handleCloseDetail = () => {
  detailModalVisible.value = false
  selectedLogId.value = null
}

/**
 * 刷新数据
 */
const refreshData = async () => {
  isRefreshing.value = true
  try {
    await Promise.all([
      loadStatistics(),
      loadTableData()
    ])
    message.success('数据刷新成功')
  } catch (error) {
    message.error('数据刷新失败')
  } finally {
    isRefreshing.value = false
  }
}

/**
 * 导出数据
 */
const exportData = async () => {
  try {
    isExporting.value = true

    // 获取所有数据（不分页）
    const exportParams = { ...filterParams, page: 0, size: 10000 }
    const response = await searchLogApi.getSearchLogs(exportParams)

    if (response.success) {
      const exportData = response.data.content.map(log => ({
        ID: log.id,
        用户ID: log.userId,
        用户IP: log.userIp,
        搜索空间: log.searchSpaceId,
        查询关键词: log.query,
        结果数量: log.resultCount,
        响应时间: log.responseTime,
        状态: log.status === 'SUCCESS' ? '成功' : '失败',
        点击次数: log.clickCount,
        创建时间: new Date(log.createdAt).toLocaleString('zh-CN')
      }))

      exportToExcel(exportData, `搜索日志_${new Date().toLocaleDateString()}`)
      message.success('数据导出成功')
    }
  } catch (error) {
    console.error('导出失败:', error)
    message.error('数据导出失败')
  } finally {
    isExporting.value = false
  }
}
</script>

<style scoped>
.search-log-manage-page {
  @apply p-6 bg-gray-50 min-h-screen;
}
</style>
```

### 2. 搜索日志筛选组件

**文件路径：** `frontend/src/components/search-log/SearchLogFilter.vue`

**筛选组件实现：**
```vue
<template>
  <div class="search-log-filter">
    <div class="filter-section">
      <h3 class="filter-title">筛选条件</h3>

      <div class="filter-grid">
        <!-- 用户ID筛选 -->
        <div class="filter-item">
          <label class="filter-label">用户ID</label>
          <Input
            v-model="localFilters.userId"
            placeholder="输入用户ID"
            clearable
          />
        </div>

        <!-- 搜索空间筛选 -->
        <div class="filter-item">
          <label class="filter-label">搜索空间</label>
          <Select
            v-model="localFilters.searchSpaceId"
            placeholder="选择搜索空间"
            clearable
          >
            <SelectOption
              v-for="space in searchSpaces"
              :key="space.id"
              :value="space.id"
              :label="space.name"
            />
          </Select>
        </div>

        <!-- 查询关键词 -->
        <div class="filter-item">
          <label class="filter-label">查询关键词</label>
          <Input
            v-model="localFilters.query"
            placeholder="输入关键词"
            clearable
          />
        </div>

        <!-- 状态筛选 -->
        <div class="filter-item">
          <label class="filter-label">状态</label>
          <Select
            v-model="localFilters.status"
            placeholder="选择状态"
            clearable
          >
            <SelectOption value="SUCCESS" label="成功" />
            <SelectOption value="ERROR" label="失败" />
          </Select>
        </div>

        <!-- 时间范围 -->
        <div class="filter-item">
          <label class="filter-label">创建时间</label>
          <DateTimePicker
            v-model:start="localFilters.startTime"
            v-model:end="localFilters.endTime"
            type="datetimerange"
            placeholder="选择时间范围"
            clearable
          />
        </div>

        <!-- 响应时间范围 -->
        <div class="filter-item">
          <label class="filter-label">响应时间(ms)</label>
          <div class="range-inputs">
            <Input
              v-model.number="localFilters.minResponseTime"
              placeholder="最小值"
              type="number"
              size="sm"
            />
            <span class="range-separator">至</span>
            <Input
              v-model.number="localFilters.maxResponseTime"
              placeholder="最大值"
              type="number"
              size="sm"
            />
          </div>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="filter-actions">
        <Button @click="handleFilter" type="primary">
          <SearchIcon class="w-4 h-4 mr-2" />
          筛选
        </Button>
        <Button @click="handleReset" variant="outline">
          <RefreshIcon class="w-4 h-4 mr-2" />
          重置
        </Button>
        <Button
          @click="toggleAdvanced"
          variant="ghost"
          size="sm"
        >
          {{ showAdvanced ? '简单筛选' : '高级筛选' }}
        </Button>
      </div>

      <!-- 高级筛选 -->
      <div v-if="showAdvanced" class="advanced-filters">
        <Divider class="my-4" />

        <div class="advanced-grid">
          <!-- 点击次数范围 -->
          <div class="filter-item">
            <label class="filter-label">点击次数</label>
            <div class="range-inputs">
              <Input
                v-model.number="localFilters.minClicks"
                placeholder="最小"
                type="number"
                size="sm"
              />
              <span class="range-separator">至</span>
              <Input
                v-model.number="localFilters.maxClicks"
                placeholder="最大"
                type="number"
                size="sm"
              />
            </div>
          </div>

          <!-- 结果数量范围 -->
          <div class="filter-item">
            <label class="filter-label">结果数量</label>
            <div class="range-inputs">
              <Input
                v-model.number="localFilters.minResults"
                placeholder="最小"
                type="number"
                size="sm"
              />
              <span class="range-separator">至</span>
              <Input
                v-model.number="localFilters.maxResults"
                placeholder="最大"
                type="number"
                size="sm"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted } from 'vue'
import { searchSpaceApi } from '@/api/searchSpace'
import type { SearchLogQuery } from '@/types/searchLog'
import type { SearchSpace } from '@/types/searchSpace'

// 组件导入
import Input from '@/components/ui/Input.vue'
import Select from '@/components/ui/Select.vue'
import SelectOption from '@/components/ui/SelectOption.vue'
import Button from '@/components/ui/Button.vue'
import DateTimePicker from '@/components/ui/DateTimePicker.vue'
import Divider from '@/components/ui/Divider.vue'

interface Props {
  modelValue: SearchLogQuery
}

interface Emits {
  (e: 'update:modelValue', value: SearchLogQuery): void
  (e: 'filter', filters: SearchLogQuery): void
  (e: 'reset'): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const showAdvanced = ref(false)
const searchSpaces = ref<SearchSpace[]>([])

// 本地筛选参数
const localFilters = reactive<SearchLogQuery>({
  ...props.modelValue
})

/**
 * 加载搜索空间列表
 */
onMounted(async () => {
  try {
    const response = await searchSpaceApi.getSearchSpaces()
    if (response.success) {
      searchSpaces.value = response.data
    }
  } catch (error) {
    console.error('加载搜索空间失败:', error)
  }
})

/**
 * 应用筛选
 */
const handleFilter = () => {
  emit('update:modelValue', { ...localFilters })
  emit('filter', { ...localFilters })
}

/**
 * 重置筛选
 */
const handleReset = () => {
  Object.keys(localFilters).forEach(key => {
    if (key !== 'page' && key !== 'size' && key !== 'sort' && key !== 'direction') {
      delete localFilters[key as keyof SearchLogQuery]
    }
  })

  emit('reset')
}

/**
 * 切换高级筛选
 */
const toggleAdvanced = () => {
  showAdvanced.value = !showAdvanced.value
}
</script>

<style scoped>
.search-log-filter {
  @apply bg-white rounded-lg;
}

.filter-section {
  @apply p-6;
}

.filter-title {
  @apply text-lg font-medium text-gray-900 mb-4;
}

.filter-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6;
}

.advanced-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-4;
}

.filter-item {
  @apply space-y-2;
}

.filter-label {
  @apply block text-sm font-medium text-gray-700;
}

.range-inputs {
  @apply flex items-center space-x-2;
}

.range-separator {
  @apply text-gray-500 text-sm;
}

.filter-actions {
  @apply flex items-center space-x-3;
}

.advanced-filters {
  @apply mt-4;
}
</style>
```

### 3. 搜索日志表格组件

**文件路径：** `frontend/src/components/search-log/SearchLogTable.vue`

**表格组件实现：**
```vue
<template>
  <div class="search-log-table">
    <!-- 表格头部 -->
    <div class="table-header">
      <div class="table-info">
        <span class="text-sm text-gray-600">
          共 {{ pagination.total }} 条记录
        </span>
      </div>
      <div class="table-actions">
        <Button @click="$emit('refresh')" size="sm" variant="outline">
          <RefreshIcon class="w-4 h-4" />
        </Button>
      </div>
    </div>

    <!-- 数据表格 -->
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>
              <SortableHeader
                field="id"
                :current-sort="currentSort"
                @sort="handleSort"
              >
                ID
              </SortableHeader>
            </th>
            <th>用户信息</th>
            <th>搜索内容</th>
            <th>
              <SortableHeader
                field="resultCount"
                :current-sort="currentSort"
                @sort="handleSort"
              >
                结果数量
              </SortableHeader>
            </th>
            <th>
              <SortableHeader
                field="responseTime"
                :current-sort="currentSort"
                @sort="handleSort"
              >
                响应时间
              </SortableHeader>
            </th>
            <th>
              <SortableHeader
                field="status"
                :current-sort="currentSort"
                @sort="handleSort"
              >
                状态
              </SortableHeader>
            </th>
            <th>点击情况</th>
            <th>
              <SortableHeader
                field="createdAt"
                :current-sort="currentSort"
                @sort="handleSort"
              >
                创建时间
              </SortableHeader>
            </th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody v-if="!loading">
          <tr
            v-for="log in data"
            :key="log.id"
            class="table-row"
            @click="$emit('view-detail', log.id)"
          >
            <td class="font-mono text-sm">{{ log.id }}</td>
            <td>
              <div class="user-info">
                <div class="user-id">{{ log.userId }}</div>
                <div class="user-ip">{{ log.userIp }}</div>
              </div>
            </td>
            <td>
              <div class="search-content">
                <div class="search-space">{{ log.searchSpaceId }}</div>
                <div class="search-query">{{ log.query }}</div>
              </div>
            </td>
            <td>
              <Badge
                :variant="log.resultCount > 0 ? 'success' : 'warning'"
              >
                {{ log.resultCount }}
              </Badge>
            </td>
            <td>
              <span
                :class="getResponseTimeClass(log.responseTime)"
                class="response-time"
              >
                {{ log.responseTime }}ms
              </span>
            </td>
            <td>
              <StatusBadge :status="log.status" />
            </td>
            <td>
              <div class="click-info">
                <span class="click-count">{{ log.clickCount }}</span>
                <Button
                  v-if="log.clickCount > 0"
                  @click.stop="$emit('view-clicks', log.id)"
                  size="xs"
                  variant="ghost"
                >
                  查看
                </Button>
              </div>
            </td>
            <td>
              <time
                :datetime="log.createdAt"
                class="text-sm text-gray-600"
              >
                {{ formatDateTime(log.createdAt) }}
              </time>
            </td>
            <td>
              <div class="action-buttons">
                <Button
                  @click.stop="$emit('view-detail', log.id)"
                  size="xs"
                  variant="outline"
                >
                  详情
                </Button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- 加载状态 -->
      <div v-if="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <span>加载中...</span>
      </div>

      <!-- 空状态 -->
      <div v-if="!loading && data.length === 0" class="empty-state">
        <EmptyIcon class="empty-icon" />
        <h3 class="empty-title">暂无数据</h3>
        <p class="empty-description">没有找到符合条件的搜索日志</p>
      </div>
    </div>

    <!-- 分页 -->
    <div v-if="!loading && data.length > 0" class="table-footer">
      <Pagination
        :current="pagination.page + 1"
        :total="pagination.total"
        :page-size="pagination.size"
        :show-size-changer="true"
        :show-quick-jumper="true"
        @change="handlePageChange"
        @show-size-change="handlePageSizeChange"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { formatDateTime } from '@/utils/date'
import type { SearchLog, PaginationData } from '@/types/searchLog'

// 组件导入
import Button from '@/components/ui/Button.vue'
import Badge from '@/components/ui/Badge.vue'
import StatusBadge from '@/components/common/StatusBadge.vue'
import SortableHeader from '@/components/ui/SortableHeader.vue'
import Pagination from '@/components/ui/Pagination.vue'

interface Props {
  data: SearchLog[]
  loading: boolean
  pagination: PaginationData
}

interface Emits {
  (e: 'page-change', page: number, size: number): void
  (e: 'sort-change', field: string, direction: 'asc' | 'desc'): void
  (e: 'view-detail', id: number): void
  (e: 'view-clicks', id: number): void
  (e: 'refresh'): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const currentSort = computed(() => ({
  field: 'createdAt', // 当前排序字段
  direction: 'desc' as 'asc' | 'desc'
}))

/**
 * 获取响应时间样式类
 */
const getResponseTimeClass = (responseTime: number) => {
  if (responseTime < 500) return 'text-green-600'
  if (responseTime < 1000) return 'text-yellow-600'
  return 'text-red-600'
}

/**
 * 处理排序
 */
const handleSort = (field: string, direction: 'asc' | 'desc') => {
  emit('sort-change', field, direction)
}

/**
 * 处理分页变化
 */
const handlePageChange = (page: number, size: number) => {
  emit('page-change', page - 1, size) // 转换为0基础索引
}

/**
 * 处理页面大小变化
 */
const handlePageSizeChange = (current: number, size: number) => {
  emit('page-change', 0, size) // 重置到第一页
}
</script>

<style scoped>
.search-log-table {
  @apply bg-white rounded-lg shadow;
}

.table-header {
  @apply flex items-center justify-between p-4 border-b border-gray-200;
}

.table-actions {
  @apply flex items-center space-x-2;
}

.table-container {
  @apply overflow-x-auto;
}

.data-table {
  @apply w-full;
}

.data-table th {
  @apply px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50;
}

.data-table td {
  @apply px-4 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200;
}

.table-row {
  @apply hover:bg-green-50 cursor-pointer transition-colors;
}

.user-info {
  @apply space-y-1;
}

.user-id {
  @apply font-medium text-gray-900;
}

.user-ip {
  @apply text-xs text-gray-500;
}

.search-content {
  @apply space-y-1 max-w-xs;
}

.search-space {
  @apply text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded;
}

.search-query {
  @apply font-medium truncate;
}

.response-time {
  @apply font-mono font-medium;
}

.click-info {
  @apply flex items-center space-x-2;
}

.click-count {
  @apply font-medium;
}

.action-buttons {
  @apply flex items-center space-x-1;
}

.loading-state {
  @apply flex items-center justify-center py-8 space-x-2;
}

.loading-spinner {
  @apply w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin;
}

.empty-state {
  @apply flex flex-col items-center justify-center py-12;
}

.empty-icon {
  @apply w-12 h-12 text-gray-400 mb-4;
}

.empty-title {
  @apply text-lg font-medium text-gray-900 mb-2;
}

.empty-description {
  @apply text-gray-500;
}

.table-footer {
  @apply p-4 border-t border-gray-200;
}
</style>
```

### 4. 详情弹窗组件

**文件路径：** `frontend/src/components/search-log/SearchLogDetailModal.vue`

**详情弹窗实现：**
```vue
<template>
  <Modal
    :visible="visible"
    :title="`搜索日志详情 #${logDetail?.id}`"
    :width="800"
    :footer="false"
    @close="$emit('close')"
  >
    <div v-if="loading" class="loading-container">
      <div class="loading-spinner"></div>
      <span>加载中...</span>
    </div>

    <div v-else-if="logDetail" class="detail-content">
      <!-- 基本信息 -->
      <section class="detail-section">
        <h3 class="section-title">基本信息</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>搜索ID:</label>
            <span class="font-mono">{{ logDetail.id }}</span>
          </div>
          <div class="info-item">
            <label>用户ID:</label>
            <span>{{ logDetail.userId }}</span>
          </div>
          <div class="info-item">
            <label>用户IP:</label>
            <span class="font-mono">{{ logDetail.userIp }}</span>
          </div>
          <div class="info-item">
            <label>搜索空间:</label>
            <span>{{ logDetail.searchSpaceId }}</span>
          </div>
          <div class="info-item">
            <label>查询关键词:</label>
            <span class="font-medium">{{ logDetail.query }}</span>
          </div>
          <div class="info-item">
            <label>状态:</label>
            <StatusBadge :status="logDetail.status" />
          </div>
          <div class="info-item">
            <label>结果数量:</label>
            <span>{{ logDetail.resultCount }}</span>
          </div>
          <div class="info-item">
            <label>响应时间:</label>
            <span
              :class="getResponseTimeClass(logDetail.responseTime)"
              class="font-mono"
            >
              {{ logDetail.responseTime }}ms
            </span>
          </div>
          <div class="info-item">
            <label>创建时间:</label>
            <span>{{ formatDateTime(logDetail.createdAt) }}</span>
          </div>
          <div class="info-item">
            <label>点击次数:</label>
            <span class="font-medium">{{ logDetail.clickCount }}</span>
          </div>
        </div>
      </section>

      <!-- 请求参数 -->
      <section class="detail-section">
        <h3 class="section-title">请求参数</h3>
        <CodeBlock
          :code="logDetail.requestParams"
          language="json"
          :collapsible="true"
        />
      </section>

      <!-- 响应数据 -->
      <section v-if="logDetail.responseData" class="detail-section">
        <h3 class="section-title">响应数据</h3>
        <CodeBlock
          :code="logDetail.responseData"
          language="json"
          :collapsible="true"
        />
      </section>

      <!-- 错误信息 -->
      <section v-if="logDetail.errorMessage" class="detail-section">
        <h3 class="section-title">错误信息</h3>
        <div class="error-message">
          {{ logDetail.errorMessage }}
        </div>
      </section>

      <!-- 点击记录 -->
      <section v-if="logDetail.clickLogs?.length > 0" class="detail-section">
        <h3 class="section-title">点击记录</h3>
        <ClickLogTable :clicks="logDetail.clickLogs" />
      </section>
    </div>

    <div v-else class="error-container">
      <ExclamationIcon class="error-icon" />
      <span>加载失败</span>
    </div>
  </Modal>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import { searchLogApi } from '@/api/searchLog'
import { formatDateTime } from '@/utils/date'
import type { SearchLogDetail } from '@/types/searchLog'

// 组件导入
import Modal from '@/components/ui/Modal.vue'
import StatusBadge from '@/components/common/StatusBadge.vue'
import CodeBlock from '@/components/ui/CodeBlock.vue'
import ClickLogTable from '@/components/search-log/ClickLogTable.vue'

interface Props {
  visible: boolean
  logId: number | null
}

interface Emits {
  (e: 'update:visible', value: boolean): void
  (e: 'close'): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const loading = ref(false)
const logDetail = ref<SearchLogDetail | null>(null)

/**
 * 监听弹窗显示状态
 */
watch(
  () => props.visible,
  (visible) => {
    if (visible && props.logId) {
      loadLogDetail()
    }
  }
)

/**
 * 监听日志ID变化
 */
watch(
  () => props.logId,
  (logId) => {
    if (logId && props.visible) {
      loadLogDetail()
    }
  }
)

/**
 * 加载日志详情
 */
const loadLogDetail = async () => {
  if (!props.logId) return

  try {
    loading.value = true
    logDetail.value = null

    const response = await searchLogApi.getSearchLogDetail(props.logId)

    if (response.success) {
      logDetail.value = response.data
    }
  } catch (error) {
    console.error('加载日志详情失败:', error)
  } finally {
    loading.value = false
  }
}

/**
 * 获取响应时间样式类
 */
const getResponseTimeClass = (responseTime: number) => {
  if (responseTime < 500) return 'text-green-600'
  if (responseTime < 1000) return 'text-yellow-600'
  return 'text-red-600'
}
</script>

<style scoped>
.loading-container,
.error-container {
  @apply flex items-center justify-center py-8 space-x-2;
}

.loading-spinner {
  @apply w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin;
}

.error-icon {
  @apply w-6 h-6 text-red-500;
}

.detail-content {
  @apply space-y-6;
}

.detail-section {
  @apply bg-gray-50 rounded-lg p-4;
}

.section-title {
  @apply text-lg font-medium text-gray-900 mb-4;
}

.info-grid {
  @apply grid grid-cols-2 gap-4;
}

.info-item {
  @apply flex flex-col space-y-1;
}

.info-item label {
  @apply text-sm font-medium text-gray-500;
}

.error-message {
  @apply bg-red-50 border border-red-200 rounded-lg p-4 text-red-800;
}
</style>
```

## 工作量估算

- **主管理页面：** 1天
- **筛选组件：** 0.5天
- **表格组件：** 0.5天
- **详情弹窗：** 0.5天
- **样式和优化：** 0.5天
- **总计：** 2-3天

## 注意事项

1. **响应式设计：** 确保在移动设备上的良好体验
2. **性能优化：** 大数据量时的分页和虚拟滚动
3. **用户体验：** 清晰的加载状态和错误提示
4. **数据安全：** 敏感信息的适当脱敏处理
5. **可访问性：** 支持键盘导航和屏幕阅读器

## 依赖关系

- **依赖任务：** 005 (需要后端API支持)
- **并行任务：** 可与006并行开发
- **后续影响：** 为008提供管理界面基础

## 相关文件

- `SearchLogManagePage.vue` - 主管理页面
- `SearchLogFilter.vue` - 筛选组件
- `SearchLogTable.vue` - 表格组件
- `SearchLogDetailModal.vue` - 详情弹窗
- `ClickLogTable.vue` - 点击记录表格
- 相关的样式和类型定义文件