---
name: ElasticsearchDataService拼音搜索增强
status: closed
created: 2025-09-25T07:09:18Z
updated: 2025-09-25T11:43:13Z
completed: 2025-09-25T11:43:13Z
github: https://github.com/zhailiang23/deepSearch/issues/46
depends_on: [44, 45]
parallel: false
conflicts_with: []
---

# Task: ElasticsearchDataService拼音搜索增强

## Description
在ElasticsearchDataService.searchData方法中增加拼音查询逻辑和相关性优化，实现中文和拼音混合查询。不重写搜索方法，而是在现有方法基础上扩展查询能力，确保向下兼容性。

## Acceptance Criteria
- [ ] 在searchData方法中增加拼音查询逻辑
- [ ] 实现bool query同时查询中文字段和拼音字段
- [ ] 支持全拼搜索：如"beijing"可搜索到"北京"
- [ ] 支持简拼搜索：如"bj"可搜索到"北京"
- [ ] 支持拼音中文混合搜索
- [ ] 优化搜索结果相关性评分算法
- [ ] 确保现有搜索功能完全不受影响
- [ ] 搜索响应时间保持≤500ms

## Technical Details
- **修改文件**: ElasticsearchDataService.java
- **核心方法**: searchData方法
- **查询策略**: 使用bool query的should子句，同时查询原字段和.pinyin字段
- **相关性优化**: 原字段匹配权重更高，拼音字段匹配权重适中
- **查询结构**:
  ```json
  {
    "bool": {
      "should": [
        {"match": {"field": "query"}},
        {"match": {"field.pinyin": "query"}}
      ]
    }
  }
  ```
- **性能考虑**: 避免过度增加查询复杂度，保持响应速度

## Dependencies
- [ ] 任务001：Elasticsearch拼音插件配置完成
- [ ] 任务002：索引映射包含拼音字段
- [ ] ElasticsearchDataService.searchData方法可修改

## Effort Estimate
- **Size**: L
- **Hours**: 16小时
- **Parallel**: false (依赖任务001和002)

## Definition of Done
- [ ] searchData方法拼音查询逻辑实现
- [ ] 全拼、简拼、混合搜索功能验证
- [ ] 相关性算法优化完成
- [ ] 向下兼容性测试通过
- [ ] 性能测试满足响应时间要求
- [ ] 单元测试覆盖新增查询逻辑
- [ ] 集成测试验证搜索功能
- [ ] 代码审查通过