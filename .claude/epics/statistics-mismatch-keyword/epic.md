---
name: statistics-mismatch-keyword
status: open
created: 2025-09-28T07:23:53Z
updated: 2025-09-28T11:55:27Z
progress: 0%
prd: .claude/prds/statistics-mismatch-keyword.md
github: https://github.com/zhailiang23/deepSearch/issues/106
---

# Epic: statistics-mismatch-keyword

## Overview

实现银行搜索系统中的关键词不匹配度分析功能，基于现有的中文分词服务和分层权重算法，实时计算并展示Top10高不匹配度关键词排行榜。系统采用Spring Boot后端处理复杂的统计计算逻辑，Vue.js前端提供直观的数据展示界面，支持多时间维度分析。

## Architecture Decisions

### 核心技术选型
- **分词服务**: 复用现有的KeywordSegmentationService，已集成jieba-java分词库
- **计算策略**: 实时计算架构，避免预计算数据一致性问题，通过数据库优化保证性能
- **缓存设计**: 使用Redis进行短期结果缓存，平衡实时性和性能要求
- **数据库优化**: 在searchLog表创建复合索引，支持高效的时间范围和关键词查询

### 设计模式
- **服务层模式**: 统计计算服务和排行榜生成服务分离
- **策略模式**: 不匹配度计算算法支持未来优化扩展

## Technical Approach

### Frontend Components
- **时间选择器组件**: 支持7天/30天/90天三个预设选项
- **排行榜表格组件**: 展示关键词统计数据，支持排序和筛选
- **加载状态组件**: 实时计算期间的友好提示界面

### Backend Services
- **统计计算服务** (`MismatchAnalysisService`):
  - 实现分层权重不匹配度算法（无结果权重1.0，少结果权重0.6）
  - 集成现有的ChineseSegmentationService进行分词处理
  - 优化的SQL查询逻辑，支持时间范围筛选

- **排行榜服务** (`RankingService`):
  - Top10关键词筛选和排序
  - 结果格式化和数据封装
  - 实时计算触发和结果返回

### Infrastructure
- **数据库索引**: 在searchLog表的(timestamp, keyword, result_count)字段创建复合索引
- **缓存层**: Redis存储计算结果的短期缓存，提升查询性能

## Implementation Strategy

### 开发阶段
1. **Phase 1 - 基础设施** (Week 1):
   - 创建数据库索引和查询优化
   - 建立统计计算服务架构
   - 集成现有KeywordSegmentationService

2. **Phase 2 - 核心算法** (Week 2):
   - 实现分层权重不匹配度计算算法
   - 开发统计查询和排行榜生成逻辑
   - 实现时间范围筛选功能

3. **Phase 3 - 前端界面** (Week 2-3):
   - 创建排行榜展示组件
   - 实现时间范围选择和实时查询
   - 添加加载状态和错误处理

4. **Phase 4 - 优化与测试** (Week 3):
   - 性能优化和缓存策略实施
   - 全面测试和bug修复
   - 部署和上线准备

### 风险缓解
- **性能风险**: 通过数据库索引优化和缓存策略降低查询延迟
- **数据一致性**: 使用事务确保统计计算的准确性
- **并发处理**: 限制并发用户数，避免系统过载

### 测试策略
- **单元测试**: 重点测试不匹配度计算算法和排行榜生成逻辑
- **集成测试**: 验证与现有分词服务的集成和前后端数据交互
- **性能测试**: 模拟大数据量场景，验证5秒响应时间要求
- **用户验收测试**: 与数据分析师和产品经理验证功能完整性

## Task Breakdown Preview

基于简化需求分析，将创建以下主要任务类别：

- [ ] **数据库优化**: 创建索引、查询优化、确保searchLog表支持结果数量字段
- [ ] **统计计算引擎**: 实现分层权重算法、集成现有分词服务、时间范围查询
- [ ] **排行榜服务**: Top10关键词筛选排序、结果格式化、实时计算触发
- [ ] **前端排行榜界面**: 数据表格展示、时间选择器、实时查询交互、加载状态
- [ ] **缓存优化方案**: Redis缓存集成、缓存策略实施
- [ ] **API接口开发**: RESTful接口设计、数据格式定义、错误处理
- [ ] **测试与部署**: 单元测试、集成测试、性能测试、生产部署

## Dependencies

### 外部服务依赖
- **searchLog数据表**: 必须包含关键词、时间戳、搜索结果状态、结果数量字段
- **现有KeywordSegmentationService**: 已完成的分词服务，包含jieba-java集成
- **PostgreSQL数据库**: 支持复杂查询和索引优化的稳定版本
- **Redis缓存**: 用于短期数据缓存的Redis实例

### 内部团队依赖
- **数据团队**: 确认searchLog表结构，提供数据质量保证
- **DBA团队**: 协助数据库查询优化和索引设计
- **运维团队**: 提供Redis缓存服务支持

### 前置工作
- searchLog表必须记录搜索结果数量字段
- 现有KeywordSegmentationService可正常调用
- Redis缓存服务的可用性确认

## Success Criteria (Technical)

### 性能基准
- **响应时间**: 实时计算在5秒内完成率 ≥ 95%
- **并发处理**: 支持5个用户同时查询无性能劣化
- **数据处理能力**: 单次处理10万条搜索记录

### 质量门禁
- **代码覆盖率**: 核心业务逻辑测试覆盖率 ≥ 90%
- **计算准确性**: 统计结果与手工验证一致性 ≥ 99%
- **系统稳定性**: 连续运行24小时无故障

### 验收标准
- 用户可选择3个时间范围进行分析
- 排行榜准确显示Top10关键词及详细统计
- 计算结果实时更新，支持页面刷新重新计算
- 分层权重算法正确计算不匹配度

## Estimated Effort

### 总体时间估算
- **开发周期**: 3周 (120工时)
- **测试周期**: 1周 (40工时)
- **部署上线**: 2天 (16工时)
- **总计**: 176工时

### 资源需求
- **后端开发**: 2名开发人员 × 2.5周
- **前端开发**: 1名开发人员 × 1.5周
- **测试工程师**: 1名 × 1周
- **DBA支持**: 0.5名 × 1周

### 关键路径项目
1. **数据库索引创建**: 必须在开发开始前完成
2. **与现有分词服务集成**: 验证接口兼容性
3. **统计算法实现**: 核心功能，影响前端界面开发
4. **性能优化**: 决定系统是否满足5秒响应要求

### 风险缓冲
- 预留15%时间用于性能优化和bug修复
- 与现有服务集成可能需要额外1天调试
- 大数据量测试和优化预留2天缓冲时间

## Tasks Created
- [ ] #107 - API接口开发 (parallel: true)
- [ ] #108 - 前端排行榜界面开发 (parallel: true)
- [ ] #109 - 统计计算服务开发 (parallel: false)
- [ ] #110 - 排行榜服务开发 (parallel: false)
- [ ] #111 - Redis缓存优化方案 (parallel: true)
- [ ] #112 - 测试与部署 (parallel: false)
- [ ] #113 - 数据库优化和索引创建 (parallel: true)

**任务统计**:
- **总任务数**: 7个
- **并行任务**: 4个 (#107, #108, #111, #113)
- **串行任务**: 3个 (#109, #110, #112)
- **预估总工时**: 72-112小时 (9-14天)

**关键路径**: #113 → #109 → #110 → #112 (约8-10天)
**并行优化**: 任务#107, #108, #111可在数据库优化完成后并行进行
